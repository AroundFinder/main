<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”ìŒì‹ì  ì°¾ê¸°</title>
    <style>
        /* ì§€ë„ì™€ í™”ë©´ êµ¬ì„±ì„ ìœ„í•œ ìŠ¤íƒ€ì¼ */
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: gray; /* ë°°ê²½ìƒ‰ ì„¤ì • */
        }

        h1 {
            margin: 20px 0;
            font-size: 24px; /* ì œëª© í°íŠ¸ í¬ê¸° ì„¤ì • */
        }

        /* ì§€ë„ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        #map {
            height: 50vh; /* ì§€ë„ì˜ ë†’ì´ë¥¼ í™”ë©´ì˜ 50%ë¡œ ì„¤ì • */
            width: 100%; /* ì§€ë„ì˜ ë„ˆë¹„ë¥¼ 100%ë¡œ ì„¤ì • */
            max-width: 1600px; /* ì§€ë„ì˜ ìµœëŒ€ ë„ˆë¹„ ì„¤ì • */
            border: 1px solid #ccc; /* ì§€ë„ì˜ ê²½ê³„ì„  ì„¤ì • */
        }

        /* ë¦¬ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        #places-list {
            max-width: 1600px;
            width: 100%;
            max-height: 300px;
            overflow-y: auto;
            background-color: white;
            padding: 10px;
            margin-top: 20px;
        }

        /* ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ ìŠ¤íƒ€ì¼ */
        .place-item {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
        }

        .place-item:hover {
            background-color: #f0f0f0;
        }

        /* ê²€ìƒ‰ì°½ ìŠ¤íƒ€ì¼ */
        #search-box {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 16px;
            outline: none;
        }

        /* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        #back-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>ê·¼ì²˜ ìŒì‹ì  ì •ë³´</h1> <!-- í˜ì´ì§€ ì œëª© -->

    <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
    <button id="back-button" onclick="history.back()">ë’¤ë¡œê°€ê¸°</button>

    <!-- ê²€ìƒ‰ì°½ -->
    <input id="search-box" type="text" placeholder="ê²€ìƒ‰í•  ì¥ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”..." />

    <!-- ì§€ë„ ì»¨í…Œì´ë„ˆ -->
    <div id="map">ì§€ë„ ë¡œë”© ì¤‘...</div>

    <!-- ìŒì‹ì  ë¦¬ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ -->
    <div id="places-list">ìŒì‹ì  ëª©ë¡ ë¡œë”© ì¤‘...</div>

    <script>
        // Google Maps API ë¡œë“œ ë° ì´ˆê¸°í™” í•¨ìˆ˜
        function initMap() {
            // ì‚¬ìš©ì ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜´
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const userLocation = {
                        lat: position.coords.latitude,  // ìœ„ë„
                        lng: position.coords.longitude  // ê²½ë„
                    };

                    // ì§€ë„ ê°ì²´ ìƒì„±
                    const map = new google.maps.Map(document.getElementById('map'), {
                        center: userLocation,  // í˜„ ìœ„ì¹˜ë¥¼ ì§€ë„ì˜ ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ì •
                        zoom: 15  // ì¤Œ ë ˆë²¨ ì„¤ì •
                    });

                    // í˜„ì¬ ìœ„ì¹˜ì— ë§ˆì»¤ ì¶”ê°€
                    const userMarker = new google.maps.Marker({
                        position: userLocation,
                        map: map,
                        title: 'Your current location',
                        icon: {
                            path: google.maps.SymbolPath.CIRCLE,
                            scale: 10,
                            fillColor: '#4285F4',
                            fillOpacity: 1,
                            strokeWeight: 1,
                            strokeColor: '#ffffff'
                        }
                    });

                    // ê²€ìƒ‰ì°½(SearchBox) ì¶”ê°€
                    const input = document.getElementById('search-box');
                    const searchBox = new google.maps.places.SearchBox(input);

                    // ê²€ìƒ‰ì°½ì—ì„œ ê²€ìƒ‰ëœ ê²°ê³¼ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                    searchBox.addListener('places_changed', function() {
                        const places = searchBox.getPlaces();

                        if (places.length === 0) {
                            return;
                        }

                        // ê²€ìƒ‰ëœ ì¥ì†Œì— ë§ˆì»¤ ì¶”ê°€
                        const bounds = new google.maps.LatLngBounds();
                        places.forEach(place => {
                            if (!place.geometry || !place.geometry.location) {
                                return;
                            }

                            // ê²€ìƒ‰ëœ ì¥ì†Œì— ë§ˆì»¤ ìƒì„±
                            createMarker(place);

                            if (place.geometry.viewport) {
                                bounds.union(place.geometry.viewport);
                            } else {
                                bounds.extend(place.geometry.location);
                            }
                        });

                        map.fitBounds(bounds);  // ì§€ë„ ë²”ìœ„ë¥¼ ê²€ìƒ‰ëœ ì¥ì†Œì— ë§ì¶¤
                    });

                    // ìŒì‹ì  ê²€ìƒ‰ ìš”ì²­ ì‹¤í–‰ (ë°˜ê²½ 10km ë‚´)
                    const service = new google.maps.places.PlacesService(map);
                    service.nearbySearch({
                        location: userLocation,
                        radius: 10000,  // ë°˜ê²½ 10km
                        type: ['restaurant']  // ìŒì‹ì  ê²€ìƒ‰
                    }, function(results, status) {
                        if (status === google.maps.places.PlacesServiceStatus.OK) {
                            displayPlaces(results);  // ê²€ìƒ‰ëœ ìŒì‹ì  ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
                            for (let i = 0; i < results.length; i++) {
                                createMarker(results[i]);  // ê²€ìƒ‰ëœ ìŒì‹ì ì— ë§ˆì»¤ ì¶”ê°€
                            }
                        }
                    });

                    // ê²€ìƒ‰ëœ ìŒì‹ì  ë¦¬ìŠ¤íŠ¸ í‘œì‹œ í•¨ìˆ˜
                    function displayPlaces(places) {
                        const placesList = document.getElementById('places-list');
                        placesList.innerHTML = '';  // ê¸°ì¡´ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”

                        places.forEach(place => {
                            const listItem = document.createElement('div');
                            listItem.className = 'place-item';
                            listItem.textContent = `${place.name} (Rating: ${place.rating || 'N/A'})`;
                            
                            // ë¦¬ìŠ¤íŠ¸ í´ë¦­ ì‹œ í•´ë‹¹ ìŒì‹ì ìœ¼ë¡œ ì§€ë„ ì´ë™
                            listItem.addEventListener('click', function() {
                                map.setCenter(place.geometry.location);
                            });

                            placesList.appendChild(listItem);
                        });
                    }

                    // ê²€ìƒ‰ëœ ì¥ì†Œì— ë§ˆì»¤ ì¶”ê°€ í•¨ìˆ˜
                    function createMarker(place) {
                        // ë§ˆì»¤ ì„¤ì •
                        const marker = new google.maps.Marker({
                            map: map,
                            position: place.geometry.location,  // ì¥ì†Œì˜ ìœ„ì¹˜ì— ë§ˆì»¤ í‘œì‹œ
                            title: place.name  // ë§ˆì»¤ì— ìŒì‹ì  ì´ë¦„ í‘œì‹œ
                        });

                        // ì •ë³´ì°½(InfoWindow) ìƒì„±
                        const infoWindow = new google.maps.InfoWindow({
                            content: `<div><strong>${place.name}</strong><br>Rating: ${place.rating || 'N/A'}</div>`
                        });

                        // ë§ˆì»¤ í´ë¦­ ì‹œ ì •ë³´ì°½ ì—´ê¸°
                        marker.addListener('click', function() {
                            infoWindow.open(map, marker);
                        });
                    }

                }, function() {
                    // ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆì„ ë•Œì˜ ì²˜ë¦¬
                    handleLocationError(true);
                });
            } else {
                // ë¸Œë¼ìš°ì €ê°€ Geolocationì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì˜ ì²˜ë¦¬
                handleLocationError(false);
            }
        }

        // ìœ„ì¹˜ ì—ëŸ¬ ì²˜ë¦¬ í•¨ìˆ˜
        function handleLocationError(browserHasGeolocation) {
            const errorMessage = browserHasGeolocation
                ? 'Error: The Geolocation service failed.'
                : 'Error: Your browser doesn\'t support geolocation.';
            alert(errorMessage);  // ì‚¬ìš©ìì—ê²Œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì•Œë¦¼
        }
    </script>

    <!-- Google Maps APIì™€ Places API ë¶ˆëŸ¬ì˜¤ê¸° -->
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAgaitdH5CfXdravO33JIt_LvNkjieIXxQ&libraries=places&callback=initMap">
    </script>
</body>
</html>
