<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nearby Parking Information</title>
    <style>
        /* ì§€ë„ì™€ í™”ë©´ êµ¬ì„±ì„ ìœ„í•œ ìŠ¤íƒ€ì¼ */
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: gray; /* ë°°ê²½ìƒ‰ ì„¤ì • */
        }

        h1 {
            margin: 20px 0;
            font-size: 24px; /* ì œëª© í°íŠ¸ í¬ê¸° ì„¤ì • */
        }

        /* ì§€ë„ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        #map {
            height: 800px; /* ì§€ë„ì˜ ë†’ì´ ì„¤ì • */
            width: 100%; /* ì§€ë„ì˜ ë„ˆë¹„ë¥¼ 100%ë¡œ ì„¤ì • */
            max-width: 1600px; /* ì§€ë„ì˜ ìµœëŒ€ ë„ˆë¹„ ì„¤ì • */
            border: 1px solid #ccc; /* ì§€ë„ì˜ ê²½ê³„ì„  ì„¤ì • */
        }

        /* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        #back-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>ğŸ…¿ï¸ ì£¼ì°¨ì¥ ì •ë³´</h1> <!-- í˜ì´ì§€ ì œëª© -->

    <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
    <button id="back-button" onclick="history.back()">ë’¤ë¡œê°€ê¸°</button>

    <!-- ì§€ë„ ì»¨í…Œì´ë„ˆ -->
    <div id="map">ì§€ë„ ë¡œë”© ì¤‘...</div>

    <script>
        // Google Maps API ë¡œë“œ ë° ì´ˆê¸°í™” í•¨ìˆ˜
        function initMap() {
            // ì‚¬ìš©ì ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜´
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const userLocation = {
                        lat: position.coords.latitude,  // ìœ„ë„
                        lng: position.coords.longitude  // ê²½ë„
                    };

                    // ì§€ë„ ê°ì²´ ìƒì„±
                    const map = new google.maps.Map(document.getElementById('map'), {
                        center: userLocation,  // í˜„ ìœ„ì¹˜ë¥¼ ì§€ë„ì˜ ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ì •
                        zoom: 15  // ì¤Œ ë ˆë²¨ ì„¤ì •
                    });

                    // í˜„ì¬ ìœ„ì¹˜ì— ë§ˆì»¤ ì¶”ê°€
                    const userMarker = new google.maps.Marker({
                        position: userLocation,
                        map: map,
                        title: 'Your current location',
                        icon: {
                            path: google.maps.SymbolPath.CIRCLE,
                            scale: 10,
                            fillColor: '#4285F4',
                            fillOpacity: 1,
                            strokeWeight: 1,
                            strokeColor: '#ffffff'
                        }
                    });

                    // ì£¼ì°¨ì¥ ê²€ìƒ‰ ìš”ì²­ ì‹¤í–‰ (ë°˜ê²½ 10km ë‚´)
                    const service = new google.maps.places.PlacesService(map);
                    service.nearbySearch({
                        location: userLocation,
                        radius: 10000,  // ë°˜ê²½ 10km
                        type: ['parking']  // ì£¼ì°¨ì¥ ê²€ìƒ‰
                    }, function(results, status) {
                        if (status === google.maps.places.PlacesServiceStatus.OK) {
                            for (let i = 0; i < results.length; i++) {
                                createMarker(results[i]);  // ê²€ìƒ‰ëœ ì£¼ì°¨ì¥ì— ë§ˆì»¤ ì¶”ê°€
                            }
                        }
                    });

                    // ê²€ìƒ‰ëœ ì¥ì†Œì— ë§ˆì»¤ ì¶”ê°€ í•¨ìˆ˜
                    function createMarker(place) {
                        // ë³„í‘œ ëª¨ì–‘ì˜ ë§ˆì»¤ ì„¤ì •
                        const marker = new google.maps.Marker({
                            map: map,
                            position: place.geometry.location,  // ì¥ì†Œì˜ ìœ„ì¹˜ì— ë§ˆì»¤ í‘œì‹œ
                            title: place.name,  // ë§ˆì»¤ì— ì£¼ì°¨ì¥ ì´ë¦„ í‘œì‹œ
                            icon: {
                                path: 'M 0,-10 3,-3 10,0 3,3 0,10 -3,3 -10,0 -3,-3 z', // ë³„ ëª¨ì–‘ ë§ˆì»¤
                                fillColor: 'yellow',
                                fillOpacity: 1,
                                strokeWeight: 1,
                                scale: 1.5
                            }
                        });

                        // ì •ë³´ì°½(InfoWindow) ìƒì„±
                        const infoWindow = new google.maps.InfoWindow({
                            content: `<div><strong>${place.name}</strong><br>Rating: ${place.rating || 'N/A'}</div>`
                        });

                        // ë§ˆì»¤ í´ë¦­ ì‹œ ì •ë³´ì°½ ì—´ê¸°
                        marker.addListener('click', function() {
                            infoWindow.open(map, marker);
                        });
                    }

                }, function() {
                    // ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆì„ ë•Œì˜ ì²˜ë¦¬
                    handleLocationError(true);
                });
            } else {
                // ë¸Œë¼ìš°ì €ê°€ Geolocationì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì˜ ì²˜ë¦¬
                handleLocationError(false);
            }
        }

        // ìœ„ì¹˜ ì—ëŸ¬ ì²˜ë¦¬ í•¨ìˆ˜
        function handleLocationError(browserHasGeolocation) {
            const errorMessage = browserHasGeolocation
                ? 'Error: The Geolocation service failed.'
                : 'Error: Your browser doesn\'t support geolocation.';
            alert(errorMessage);  // ì‚¬ìš©ìì—ê²Œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì•Œë¦¼
        }
    </script>

    <!-- Google Maps APIì™€ Places API ë¶ˆëŸ¬ì˜¤ê¸° -->
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAgaitdH5CfXdravO33JIt_LvNkjieIXxQ&libraries=places&callback=initMap">
    </script>
</body>
</html>
